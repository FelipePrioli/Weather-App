<div class="page">
  <!-- ================= HEADER ================= -->
  <header class="page-header">
    <div class="left-actions">
      <!-- Estado padrÃ£o -->
      <ng-container *ngIf="!showFavorites; else favoritesHeader">
        <h1>ğŸŒ¦ï¸ PrevisÃ£o do Tempo</h1>
        <button class="btn-icon" *ngIf="user$ | async" (click)="goToFavorites()">Favoritos</button>
      </ng-container>

      <!-- Estado favoritos -->
      <ng-template #favoritesHeader>
        <button class="btn-icon" (click)="backToSearch()">â† Voltar</button>
        <h1>âœ¨ Favoritos</h1>
      </ng-template>
    </div>

    <div class="auth-actions">
      <ng-container *ngIf="user$ | async as user; else guest">
        <span class="welcome">
          OlÃ¡, <strong>{{ user.nome }}</strong>
        </span>
        <button class="btn-outline" (click)="logout()">Sair</button>
      </ng-container>

      <ng-template #guest>
        <button class="btn-outline" (click)="showLogin = true">Login</button>
        <button class="btn-primary" (click)="showRegister = true">Registrar</button>
      </ng-template>
    </div>
  </header>

  <!-- ================= MENSAGENS ================= -->
  <div *ngIf="authSuccess" class="success-message">
    {{ authSuccess }}
  </div>

  <div *ngIf="authError" class="error-message">
    {{ authError }}
  </div>

  <!-- ================================================= -->
  <!-- ================= FAVORITES ===================== -->
  <!-- ================================================= -->
  <main class="app-container" *ngIf="showFavorites && (user$ | async)">
    <app-favorites (favoriteClicked)="onFavoriteSelected($event)"> </app-favorites>
  </main>

  <!-- ================================================= -->
  <!-- ================= BUSCA / CLIMA ================= -->
  <!-- ================================================= -->
  <ng-container *ngIf="!showFavorites">
    <main class="app-container">
      <p class="intro-text">Escreva o nome da cidade para ter acesso Ã  previsÃ£o do tempo</p>

      <!-- SEARCH -->
      <div class="search-container">
        <input type="text" placeholder="Digite a cidade" [(ngModel)]="city" />
        <button (click)="search()">Buscar</button>
      </div>

      <!-- LOADING -->
      <div class="loading" *ngIf="loading">
        <span class="spinner"></span>
        Carregando...
      </div>

      <!-- ================= WEATHER CARD ================= -->
      <section class="weather-card" *ngIf="weather && !loading">
        <!-- CIDADE + FAVORITO -->
        <div class="weather-location">
          <h2>{{ weather.city }}</h2>

          <button class="favorite-btn" (click)="addToFavorites()" title="Adicionar aos favoritos">
            â¤ï¸
          </button>
        </div>

        <!-- AGORA -->
        <div class="weather-now">
          <img
            [src]="'https://openweathermap.org/img/wn/' + weather.icon + '@2x.png'"
            alt="Ãcone do clima"
          />

          <div class="weather-main">
            <span class="temp" [ngClass]="getTempClass(weather.temperature)">
              {{ weather.temperature | number: '1.0-0' }}Â°C
            </span>

            <span class="description">
              {{ weather.description }}
            </span>
          </div>
        </div>

        <!-- DETALHES -->
        <div class="weather-details">
          <div class="detail-card">
            <span class="label">Min â†“</span>
            <strong>{{ weather.tempMin | number: '1.0-0' }}Â°C</strong>
          </div>

          <div class="detail-card">
            <span class="label">Max â†‘</span>
            <strong>{{ weather.tempMax | number: '1.0-0' }}Â°C</strong>
          </div>

          <div class="detail-card">
            <span class="label">Umidade ğŸ’§</span>
            <strong>{{ weather.humidity }}%</strong>
          </div>
        </div>
      </section>

      <!-- BOTÃƒO FORECAST -->
      <button
        class="btn-icon"
        style="margin-top: 16px; width: 100%; justify-content: center; border: 1px solid #00000048"
        *ngIf="weather && !loading"
        (click)="toggleForecast()"
      >
        ğŸŒ¤ï¸ {{ showForecast ? 'Ocultar previsÃ£o' : 'Ver previsÃ£o dos prÃ³ximos 5 dias' }}
      </button>
    </main>

    <section class="empty-state" *ngIf="!weather && !loading">
      <h2>Descubra o clima da sua cidade</h2>

      <p>Digite o nome de uma cidade acima para ver a previsÃ£o atual e os prÃ³ximos 5 dias.</p>

      <div class="suggestions">
        <span (click)="city = 'SÃ£o Paulo'">SÃ£o Paulo</span>
        <span (click)="city = 'Rio de Janeiro'">Rio de Janeiro</span>
        <span (click)="city = 'BrasÃ­lia'">BrasÃ­lia</span>
      </div>
    </section>

    <!-- ================= FORECAST ================= -->
    <section *ngIf="showForecast && forecast.length && weather" style="margin-top: 32px">
      <h3 style="margin-bottom: 16px">PrevisÃ£o de 5 dias â€” {{ weather.city }}</h3>

      <div class="forecast-grid">
        <div class="forecast-card" *ngFor="let day of forecast">
          <div class="top-info">
            {{ day.description | titlecase }} - {{ day.date | date: 'dd/MM' }}
          </div>

          <img
            class="icon"
            [src]="'https://openweathermap.org/img/wn/' + day.icon + '@2x.png'"
            alt="Ãcone do clima"
          />

          <span class="temp">
            â†“ {{ day.tempMin | number: '1.0-0' }}Â°C â€” {{ day.tempMax | number: '1.0-0' }}Â°C â†‘
          </span>
        </div>
      </div>
    </section>
  </ng-container>

  <!-- ================= MODAL LOGIN ================= -->
  <div class="modal" *ngIf="showLogin">
    <div class="modal-card">
      <h2>Login</h2>

      <input type="email" placeholder="E-mail" [(ngModel)]="email" />
      <input type="password" placeholder="Senha" [(ngModel)]="senha" />

      <small *ngIf="authError" class="error">
        {{ authError }}
      </small>

      <button class="btn-primary" (click)="login()">Entrar</button>
      <button class="btn-outline" (click)="showLogin = false">Cancelar</button>
    </div>
  </div>

  <!-- ================= MODAL REGISTRO ================= -->
  <div class="modal" *ngIf="showRegister">
    <div class="modal-card">
      <h2>Registrar</h2>

      <input type="text" placeholder="Nome" [(ngModel)]="nome" />
      <input type="email" placeholder="E-mail" [(ngModel)]="email" />
      <input type="password" placeholder="Senha" [(ngModel)]="senha" />

      <small *ngIf="authError" class="error">
        {{ authError }}
      </small>

      <button class="btn-primary" (click)="register()">Criar conta</button>
      <button class="btn-outline" (click)="showRegister = false">Cancelar</button>
    </div>
  </div>
</div>
